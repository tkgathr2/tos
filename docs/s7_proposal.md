# S-7 検討結果（確定）

**最終確定日: 2025-12-14**
**検討ID: EXT-20251214-001 / EXT-20251214-002**
**結論: やらない（S-7 は不要）**

本ドキュメントは S-7（拡張フェーズ）の必要性を正史に基づき検討した結果を記録します。

---

## 最終結論（確定）

### 結論

**S-7 は「やらない」（不要）**

### 結論理由（3点以上）

1. **主要目的達成済み**: 自動リトライ機能は S-6 で既に実装されている（orchestrator_v0_3.py:201-258）
2. **代替手段存在**: 残りの機能（ログローテーション、監視アラート）は外部ツール/手動運用で代替可能
3. **安定性優先**: S-6 stable は 2025-12-14 に完成したばかりであり、安定運用実績を蓄積すべき時期である
4. **リスク回避**: 機能追加による障害リスクを避けるべきである
5. **費用対効果**: 実装コストに見合う価値が現時点では存在しない

### 却下した選択肢の理由

| 選択肢 | 却下理由 |
|--------|---------|
| **やる** | 業務上の緊急性がない、S-6 安定運用が優先、自動リトライは既存 |
| **保留** | 検討B により「やらない」が合理的と判明、再検討条件は明文化済み |

### 結論が変わる条件

以下の条件が発生した場合に限り、S-7 検討を再開する：

1. ディスク容量 80% 到達（ログローテーション検討）
2. API エラーが週 5 回以上発生（リトライ設定の見直し）
3. 異常検知遅延による業務影響（監視アラート検討）
4. 処理待ち時間が 1 時間超（マルチプロセス検討）
5. 新規業務要件の発生

### 結論の有効期限

**有効期限: 2025-06-14（6ヶ月後）**

上記日付以降、または上記トリガー条件発生時に再検討を許可する。
それ以前の再検討は原則禁止。

### 位置づけ

| 観点 | 位置づけ |
|------|---------|
| **経営判断** | S-6 安定運用を優先し、リスクを冒さない「待ち」が合理的 |
| **技術判断** | 自動リトライは既存、残りは代替可能。追加実装は不要 |
| **運用判断** | 手動運用＋ルール整備で対応可能。自動化のリスクを避ける |

### 正史に残す判断文（確定）

```
S-7（拡張フェーズ）は実施しない。

理由:
1. 自動リトライ機能は S-6 で既に実装されている
2. 残りの機能は外部ツール/手動運用で代替可能
3. S-6 stable の安定運用を優先する
4. 機能追加による障害リスクを避ける
5. 実装コストに見合う価値が現時点では存在しない

以上により、S-7 は「不要」と確定し、S-6 stable の運用を継続する。
再検討は 2025-06-14 以降、または明文化されたトリガー条件発生時にのみ許可する。
```

---

## 検討結果の集約

### 指示書061（検討A）の結論要約

- **結論**: 保留
- **理由**: S-6 stable が本日完成したばかり、30日以上の安定運用が拡張検討の条件
- **Must 項目**: なし
- **Should 項目**: 自動リトライ、ログローテーション

### 指示書062（検討B）の結論要約

- **結論**: やらない（不要）
- **重要な発見**: 自動リトライは既に S-6 で実装済み
- **技術リスク最大項目**: マルチプロセス（状態管理の複雑化、phase_state 破損リスク）
- **運用リスク最大項目**: マルチプロセス（デバッグ困難、障害時の原因特定困難）
- **価値最大項目**: 自動リトライ（既に実装済み）

### 両者で一致している点

1. Must 項目は存在しない
2. S-6 stable の安定運用が優先される
3. マルチプロセス、リモート実行、GUI、クロスプラットフォームはスコープ外
4. 現行機能で業務は遂行可能
5. リスクを冒す合理的理由がない

### 両者で意見が分かれた点

| 項目 | 検討A | 検討B |
|------|-------|-------|
| 結論 | 保留 | やらない |
| 自動リトライ | Should（あると便利） | **既存で実装済み** |

**最終判断**: 検討B の「やらない」を採用（自動リトライが既存であることが判明したため）

---

---

## A. 要件整理

### A-1. S-7 で追加したいこと（候補一覧）

S-6 governance で「既知の未対応事項」として挙げられた項目を中心に列挙：

1. **自動リトライ機能**: API エラー時の自動再試行
2. **マルチプロセス対応**: 並列実行による高速化
3. **ログローテーション自動化**: 古いログの自動削除/アーカイブ
4. **監視アラート連携**: 異常検知時の通知機能
5. **リモート実行対応**: ネットワーク経由での実行
6. **GUI**: グラフィカルユーザーインターフェース
7. **クロスプラットフォーム対応**: macOS/Linux での動作

### A-2. 各項目の目的（なぜ必要か）

| 項目 | 目的 |
|------|------|
| 自動リトライ | 一時的な API 障害からの自動復旧 |
| マルチプロセス | 大量ジョブの処理時間短縮 |
| ログローテーション | 長期運用時のディスク管理自動化 |
| 監視アラート | 異常の早期発見と迅速な対応 |
| リモート実行 | 複数マシンでの分散実行 |
| GUI | 非技術者でも操作可能に |
| クロスプラットフォーム | 利用環境の選択肢拡大 |

### A-3. 各項目の利用者（誰が使うか）

| 項目 | 利用者 |
|------|--------|
| 自動リトライ | 運用担当者（自動で動作） |
| マルチプロセス | 大量処理が必要な運用者 |
| ログローテーション | 長期運用担当者 |
| 監視アラート | 運用監視担当者 |
| リモート実行 | インフラ担当者 |
| GUI | 非技術者、エンドユーザー |
| クロスプラットフォーム | macOS/Linux ユーザー |

### A-4. 各項目の頻度（毎日/週次/随時）

| 項目 | 頻度 |
|------|------|
| 自動リトライ | 随時（エラー発生時） |
| マルチプロセス | 毎日（大量処理時） |
| ログローテーション | 週次/月次 |
| 監視アラート | 随時（異常発生時） |
| リモート実行 | 随時 |
| GUI | 毎日 |
| クロスプラットフォーム | 随時 |

### A-5. 各項目の成功条件

| 項目 | 成功条件 |
|------|---------|
| 自動リトライ | 一時的エラーから自動復旧し、ジョブが完了する |
| マルチプロセス | 並列実行により処理時間が短縮される |
| ログローテーション | 古いログが自動削除され、ディスク容量が管理される |
| 監視アラート | 異常発生時に通知が届き、迅速な対応が可能になる |
| リモート実行 | ネットワーク経由で正常に実行・結果取得できる |
| GUI | コマンドなしで操作・監視ができる |
| クロスプラットフォーム | macOS/Linux で同等の動作が確認できる |

### A-6. 既存 S-6 で代替できない理由

| 項目 | S-6 で代替できない理由 |
|------|----------------------|
| 自動リトライ | 現状は手動再実行のみ |
| マルチプロセス | 単一プロセス設計のため不可 |
| ログローテーション | 手動削除のみ対応 |
| 監視アラート | 外部ツール連携が必要 |
| リモート実行 | ローカル実行のみ対応 |
| GUI | コマンドラインのみ |
| クロスプラットフォーム | Windows 専用設計 |

### A-7. 不要になった場合の撤回条件

| 項目 | 撤回条件 |
|------|---------|
| 自動リトライ | API が安定し、手動リトライで十分な場合 |
| マルチプロセス | 処理量が増えず、現行速度で十分な場合 |
| ログローテーション | 手動管理で問題ない場合 |
| 監視アラート | 外部ツールで十分な場合 |
| リモート実行 | ローカル実行のみで十分な場合 |
| GUI | コマンドライン運用で十分な場合 |
| クロスプラットフォーム | Windows 環境のみで運用する場合 |

---

## B. 影響範囲の洗い出し

### B-1. 変更が入る可能性のあるファイル

| 項目 | 変更対象ファイル |
|------|----------------|
| 自動リトライ | orchestrator_v0_3.py, config_v0_3.json |
| マルチプロセス | orchestrator_v0_3.py, cc_run.ps1 |
| ログローテーション | cc_run.ps1, 新規スクリプト |
| 監視アラート | 新規スクリプト/設定 |
| リモート実行 | 大幅な設計変更 |
| GUI | 新規アプリケーション |
| クロスプラットフォーム | cc_run.ps1 の bash 版、パス処理 |

### B-2. 変更が入る可能性のある入出力

| 項目 | 入出力への影響 |
|------|--------------|
| 自動リトライ | retry_count を step_log に追加 |
| マルチプロセス | 並列実行結果のマージ |
| ログローテーション | ログファイル構造の変更可能性 |
| 監視アラート | アラート設定の入力追加 |
| リモート実行 | ネットワーク設定の入力追加 |
| GUI | 画面入出力追加 |
| クロスプラットフォーム | パス形式の統一 |

### B-3. 変更が入る可能性のあるログ

| 項目 | ログへの影響 |
|------|------------|
| 自動リトライ | retry 情報の追加 |
| マルチプロセス | プロセス ID の追加 |
| ログローテーション | ログファイル名規則の変更 |
| 監視アラート | アラート履歴の追加 |
| リモート実行 | 実行ホスト情報の追加 |
| GUI | 操作ログの追加 |
| クロスプラットフォーム | パス表記の統一 |

### B-4. 後方互換性に影響する点

- config_v0_3.json のスキーマ変更
- step_log のフィールド追加
- ログファイル構造の変更
- 実行手順の変更

### B-5. セキュリティ/安全性に影響する点

- リモート実行: ネットワーク経由のセキュリティリスク
- 監視アラート: 通知先の認証情報管理
- GUI: 認証/認可の追加

### B-6. 運用手順に影響する点

- 新機能の操作手順追加
- トラブルシューティング手順の更新
- 引き継ぎドキュメントの更新

### B-7. 失敗時ロールバック難度

| 項目 | ロールバック難度 |
|------|----------------|
| 自動リトライ | 低（設定変更で無効化可能） |
| マルチプロセス | 中（コード変更が必要） |
| ログローテーション | 低（スクリプト削除で無効化） |
| 監視アラート | 低（設定変更で無効化可能） |
| リモート実行 | 高（設計変更が大きい） |
| GUI | 低（別アプリのため分離可能） |
| クロスプラットフォーム | 中（テスト環境の整備が必要） |

### B-8. テスト追加が必要な箇所

- 新機能の単体テスト
- 既存機能との結合テスト
- 後方互換性テスト
- 異常系テスト

### B-9. ドキュメント更新が必要な箇所

- README.md
- runbook.md
- 新機能用ドキュメント
- glossary.md（用語追加）

### B-10. 影響範囲が S-6 を壊さないか評価

**評価結果**: 多くの項目で S-6 への影響が大きい

- 自動リトライ: 中程度の影響（設定追加）
- マルチプロセス: 大きな影響（設計変更）
- ログローテーション: 小さな影響（追加スクリプト）
- 監視アラート: 小さな影響（外部連携）
- リモート実行: 大きな影響（設計変更）
- GUI: 小さな影響（別アプリ）
- クロスプラットフォーム: 中程度の影響（互換性確保）

---

## C. 優先順位とスコープ

### C-1. Must/Should/Could 分類

| 分類 | 項目 |
|------|------|
| Must | なし |
| Should | 自動リトライ、ログローテーション |
| Could | マルチプロセス、監視アラート |
| スコープ外 | リモート実行、GUI、クロスプラットフォーム |

### C-2. Must の上位3つ

**該当なし**

現時点で「必須」とすべき項目はない。S-6 stable の安定運用が優先される。

### C-3. Should の上位3つ

1. **自動リトライ**: API 一時障害への対応として有用
2. **ログローテーション**: 長期運用の管理負荷軽減
3. （なし）

### C-4. Could は凍結候補

以下は S-7 以降でも優先度が低く、凍結候補：

- マルチプロセス（現行速度で十分な場合）
- 監視アラート（外部ツールで代替可能）

### C-5. スコープ外（やらないこと）

以下は S-7 のスコープ外とする：

1. リモート実行（設計変更が大きすぎる）
2. GUI（別プロジェクトとして検討すべき）
3. クロスプラットフォーム（需要が不明）

### C-6. 1回目リリースで絶対に入れない項目

- リモート実行
- GUI
- クロスプラットフォーム
- マルチプロセス（検証不足）

### C-7. MVP（最小）仕様

**S-7 MVP（仮）**:

1. 自動リトライ機能（config で有効/無効切替可能）
2. リトライ回数・間隔の設定
3. リトライログの記録

### C-8. MVP の非目標（やらないこと）

- 複雑なリトライ戦略（指数バックオフなど）
- リトライ対象エラーのカスタマイズ
- 並列リトライ

### C-9. PoC で済ませる条件

以下の場合は PoC で終了とし、本実装は見送る：

1. 自動リトライが複雑すぎる場合
2. 既存動作への影響が大きすぎる場合
3. 運用負荷が軽減されない場合

### C-10. Stable に戻る条件（撤退条件）

以下の場合は S-7 を中止し、S-6 stable に戻る：

1. S-7 の変更が S-6 の安定性を損なう場合
2. テストで重大な問題が発見された場合
3. 業務要件が変更され、不要になった場合
4. リソースが確保できない場合

---

## D. 進め方

### D-1. S-7 を進める場合のフェーズ分割案

| フェーズ | 内容 | 期間目安 |
|---------|------|---------|
| S-7a | 自動リトライ設計・PoC | 1週間 |
| S-7b | 自動リトライ実装・テスト | 1週間 |
| S-7c | ログローテーション設計・実装 | 1週間 |
| S-7d | 安定化・ドキュメント整備 | 1週間 |

### D-2. 各フェーズの成功条件

| フェーズ | 成功条件 |
|---------|---------|
| S-7a | 設計ドキュメント完成、PoC で動作確認 |
| S-7b | 自動リトライ機能が正常動作、テスト通過 |
| S-7c | ログローテーションが正常動作 |
| S-7d | 全テスト通過、ドキュメント完成 |

### D-3. 各フェーズのチェックポイント名案

- S-7a: `S-7a_retry_design`
- S-7b: `S-7b_retry_impl`
- S-7c: `S-7c_logrotate`
- S-7d: `S-7d_stable`

### D-4. 各フェーズのテスト方針

- 各フェーズ完了時に test モード実行
- 既存機能の後方互換性テスト
- 新機能の単体テスト
- S-6 相当の動作確認

### D-5. 各フェーズのログ方針

- 既存ログ形式を維持
- 新機能のログは追加フィールドとして実装
- ログスキーマ変更は最小限

### D-6. 失敗時の戻り先

- 各フェーズの開始時チェックポイントに戻る
- 最悪の場合、S-6 stable（`de2cb84`）に戻る

### D-7. 50指示一括運用の可否

**可否**: 可（条件付き）

条件:
- 各フェーズを 50 指示以内に収める
- フェーズ間で状態を確認
- 問題発生時は即座に中断

### D-8. 指示粒度を落とす条件

以下の場合は指示粒度を 20-30 指示に落とす：

- 設計が複雑な場合
- 影響範囲が予想以上に大きい場合
- テストで問題が多発する場合

### D-9. 正史更新の手順（v1.0→v1.1など）

1. S-7 完了時に正史コンテキスト v1.1 を定義
2. README.md, runbook.md を更新
3. glossary.md に新用語を追加
4. release_notes.md に S-7 変更を記載

### D-10. S-7 検討結果を残すファイル名

- 本ドキュメント: `docs/s7_proposal.md`
- 承認後の設計: `docs/s7_design.md`（必要時に作成）
- 実装ログ: `docs/s7_impl_log.md`（必要時に作成）

---

## E. 結論

### E-1. S-7 の必要性判断

**結論: 保留**

### E-2. 判断理由

1. **S-6 stable が本日（2025-12-14）完成したばかり**
   - S-6 governance では「30日以上の安定運用」が拡張検討の条件
   - 現時点では条件を満たさない

2. **明確な業務要件がない**
   - 自動リトライ、ログローテーションは「あると便利」レベル
   - 現行運用で致命的な問題は発生していない

3. **現行機能で運用可能**
   - S-6 stable の機能で日常運用は可能
   - 限界は既知であり、受け入れられている

4. **リソースの優先順位**
   - まずは S-6 stable の安定運用を優先
   - 拡張は安定運用が確認されてから

### E-3. 次のアクション

1. **S-6 stable を 30 日間運用**
   - 安定性を確認
   - 運用上の課題を収集

2. **課題収集後に再検討**
   - 実際の運用で問題が発生した場合に再検討
   - 業務要件が明確になった場合に再検討

3. **本ドキュメントを正史に残す**
   - S-7 検討の記録として保存
   - 再検討時の参考資料とする

### E-4. 再検討のトリガー

以下の場合に S-7 検討を再開する：

1. API エラーが頻発し、自動リトライが必須となった場合
2. ログ管理が運用負荷となった場合
3. 新たな業務要件が発生した場合
4. S-6 stable が 30 日以上安定運用された場合

---

## 正史コンテキスト v1.0 との整合

本ドキュメントは正史コンテキスト v1.0 に準拠しています。

- S-7 は「検討」段階であり、実装は行わない
- 本ドキュメントは検討記録として正史に残す
- 結論が「保留」であることを明記

### 正史更新履歴

- 2025-12-14: S-7 検討A 実施
- 2025-12-14: 結論「保留」を記録
- 2025-12-14: S-7 検討B 実施
- 2025-12-14: **S-7 結論「やらない」を確定**

---

# S-7 検討B: 実行可能性・危険点・代替案の詳細分析

**検討日: 2025-12-14**
**検討ID: EXT-20251214-002**

本セクションは S-7 を「やる場合」に備えた実行可能性・危険点・代替案を徹底的に洗い出した結果を記録します。

---

## A. 技術的実現性チェック（1–10）

### A-1. Must 項目の実装難易度評価

| 項目 | 難易度 | 理由 |
|------|--------|------|
| **該当なし** | - | 検討Aで Must 項目なしと判定 |

※ Should 項目を参考として評価：

| 項目 | 難易度 | 理由 |
|------|--------|------|
| 自動リトライ | **低** | **既に実装済み**（orchestrator_v0_3.py:201-258）。api_retry=2 で動作中。追加不要 |
| ログローテーション | **低** | 外部スクリプト追加のみ。既存コードへの変更不要 |

### A-2. 難易度「高」の項目と理由

| 項目 | 難易度 | 具体的理由 |
|------|--------|-----------|
| マルチプロセス | 高 | 状態管理の競合、ログ出力の同期、phase_state.json の排他制御が必要 |
| リモート実行 | 高 | 認証・認可、ネットワーク設計、エラー復旧の複雑化 |
| GUI | 高 | 完全新規アプリケーション、技術選定から必要 |
| クロスプラットフォーム | 高 | PowerShell 依存の解消、パス形式統一、テスト環境の整備 |

### A-3. 既存コードで再利用できる部分

| 再利用可能な既存コード | ファイル:行番号 | 説明 |
|-----------------------|----------------|------|
| API リトライ機構 | orchestrator_v0_3.py:201-258 | 指数バックオフ付き自動リトライ済み |
| JSON パースリトライ | orchestrator_v0_3.py:261-294 | json_retry プレフィックス付きリトライ済み |
| ステップログ出力 | orchestrator_v0_3.py:297-413 | スキーマ固定、拡張容易 |
| フェーズ状態管理 | orchestrator_v0_3.py:54-127 | phase_state.json 保存・復元済み |
| allowlist/denylist | orchestrator_v0_3.py:506-588 | 実行ポリシー判定済み |
| config 構造 | config_v0_3.json | 設定追加で拡張可能 |

### A-4. 新規実装が必要なコンポーネント

| 項目 | 新規コンポーネント | 規模 |
|------|-------------------|------|
| 自動リトライ | **不要**（既存で十分） | - |
| ログローテーション | rotate_logs.ps1 スクリプト | 小（50行程度） |
| 監視アラート | alert_notifier.py + config 拡張 | 中（200行程度） |
| マルチプロセス | プロセス管理モジュール全体 | 大（500行以上） |

### A-5. 外部ライブラリ依存の発生可能性

| 項目 | 外部ライブラリ | 必要性 |
|------|---------------|--------|
| 自動リトライ | なし | **既存で完結** |
| ログローテーション | なし | PowerShell 標準機能で実装可能 |
| 監視アラート | requests（既存）+ Slack SDK 等 | 通知先による |
| マルチプロセス | multiprocessing（標準）| 追加インストール不要 |
| GUI | tkinter/PyQt/Electron 等 | 大規模依存発生 |

### A-6. API 制約（レート/価格/制限）の影響評価

| 観点 | 現状 | S-7 での影響 |
|------|------|-------------|
| OpenAI レート制限 | gpt-4o-mini: 10,000 RPM | 影響なし（現行利用量で十分） |
| OpenAI 価格 | $0.15/1M input, $0.60/1M output | マルチプロセスで並列化すると増加 |
| Anthropic レート制限 | Haiku: 制限緩い | 影響なし |
| Anthropic 価格 | $0.25/1M input, $1.25/1M output | マルチプロセスで増加 |

**結論**: マルチプロセス以外は API 制約への影響は軽微

### A-7. 実装失敗時の代替手段

| 項目 | 代替手段 |
|------|---------|
| 自動リトライ | **既存動作を継続**（変更不要のため失敗なし） |
| ログローテーション | 手動削除（現行運用）/ タスクスケジューラで手動設定 |
| 監視アラート | logs/phase_summary.json を手動監視 / 外部ツール連携 |
| マルチプロセス | 逐次実行を継続（現行動作） |

---

## B. 運用・安全面の検証（11–20）

### B-1. 運用負荷の増加評価

| 項目 | 運用負荷増加 | 説明 |
|------|-------------|------|
| 自動リトライ | **なし**（既存） | 設定済み、監視項目変更なし |
| ログローテーション | 微増 | ローテーションスケジュール設定が必要 |
| 監視アラート | 増加 | 通知先設定・誤報対応・通知ルール調整 |
| マルチプロセス | 大幅増加 | 並列実行の監視・デバッグ複雑化 |

### B-2. 人的ミスが増えるポイント

1. **ログローテーション**: 保持期間の誤設定で重要ログ消失
2. **監視アラート**: 通知先の誤設定でアラート未達
3. **マルチプロセス**: 並列数の誤設定で API レート制限超過
4. **config 編集**: 新設定項目の JSON 構文エラー
5. **スケジュール設定**: タスクスケジューラの時刻/頻度ミス

### B-3. ロールバック難易度の再評価

| 項目 | ロールバック難易度 | 具体的手順 |
|------|-------------------|-----------|
| 自動リトライ | **不要** | 既存動作のため変更なし |
| ログローテーション | 低 | スクリプト削除 + タスクスケジューラから削除 |
| 監視アラート | 低 | config の enabled=false で無効化 |
| マルチプロセス | 中 | コード変更が必要、phase_state 整合性確認必要 |

### B-4. 障害発生時の影響範囲

| 障害シナリオ | 影響範囲 |
|-------------|---------|
| ログローテーション失敗 | ディスク容量逼迫→全処理停止の可能性 |
| 監視アラート失敗 | 異常検知遅延（運用影響は限定的） |
| マルチプロセス競合 | phase_state 破損→復旧困難 |
| API リトライ上限到達 | 現行動作（処理中断、ログ記録） |

### B-5. S-6 stable を壊すリスクがある箇所

| 箇所 | リスク内容 | 対策 |
|------|-----------|------|
| orchestrator_v0_3.py | コア実行ロジック変更 | **変更しない**（S-7 は外部スクリプト追加のみ推奨） |
| config_v0_3.json | スキーマ変更 | 新設定は optional、デフォルト値設定 |
| phase_state.json | フィールド追加 | 後方互換性を維持（新フィールドは nullable） |
| step_log スキーマ | フィールド追加 | build_step_log_data で追加（既存フィールド維持） |

### B-6. セキュリティ上の新リスク

| 項目 | セキュリティリスク |
|------|-------------------|
| 自動リトライ | なし（既存動作） |
| ログローテーション | 削除スクリプトの誤動作で重要ファイル消失 |
| 監視アラート | Webhook URL/API キーの漏洩、通知内容にセンシティブ情報 |
| マルチプロセス | 並列実行時のファイルロック競合 |

### B-7. 権限・認可に影響が出る点

| 影響点 | 内容 |
|--------|------|
| ファイルシステム権限 | ログローテーションに削除権限が必要 |
| 環境変数 | 監視アラート用の API キー追加が必要 |
| タスクスケジューラ | ローテーションタスク登録に管理者権限が必要な場合あり |

### B-8. ログ・証跡が不足する可能性

| 項目 | 不足する可能性のある証跡 |
|------|------------------------|
| ログローテーション | 削除したファイル一覧の記録 |
| 監視アラート | 通知送信成否の記録 |
| マルチプロセス | プロセス間の実行順序・競合の記録 |

### B-9. 想定外入力時の挙動

| 項目 | 想定外入力 | 現行の挙動 |
|------|-----------|-----------|
| config 不正値 | max_jobs=-1 | エラーメッセージなし（そのまま動作） |
| job_input.json 不正 | JSON構文エラー | 例外発生→処理中断 |
| ログファイル破損 | step_*.json が不正 | phase_summary 生成時にスキップ |

### B-10. 「やらない方が安全」な項目

| 項目 | 理由 |
|------|------|
| マルチプロセス | 状態管理の複雑化、デバッグ困難、phase_state 破損リスク |
| リモート実行 | ネットワーク依存、セキュリティリスク大 |
| GUI | 攻撃面の拡大、認証必要、メンテナンスコスト |
| クロスプラットフォーム | テスト工数大、Windows 専用で十分 |

---

## C. ビジネス・価値面の再評価（21–30）

### C-1. Must 項目の費用対効果再評価

**Must 項目は存在しないため該当なし**

Should 項目の費用対効果：

| 項目 | 実装コスト | 価値 | 費用対効果 |
|------|-----------|------|-----------|
| 自動リトライ | **ゼロ**（既存） | API 一時障害からの自動復旧 | **∞**（既に享受中） |
| ログローテーション | 低（数時間） | 長期運用のディスク管理自動化 | 中 |

### C-2. Should 項目を後回しにした場合の影響

| 項目 | 後回し時の影響 |
|------|---------------|
| 自動リトライ | **影響なし**（既存動作で運用中） |
| ログローテーション | ディスク容量手動監視が必要、数ヶ月後に問題化する可能性 |

### C-3. Could 項目を捨てた場合の影響

| 項目 | 捨てた場合の影響 |
|------|-----------------|
| マルチプロセス | 大量ジョブ時の処理時間が長いまま（現状許容範囲） |
| 監視アラート | 異常時の手動監視継続（現状許容範囲） |

### C-4. 実装コストに見合う価値があるか再判断

| 項目 | 判断 | 理由 |
|------|------|------|
| 自動リトライ | **実装不要**（既存） | 既に動作中 |
| ログローテーション | **価値あり** | 実装コスト低、長期運用に必須 |
| 監視アラート | **保留** | 外部ツールで代替可能 |
| マルチプロセス | **見送り** | リスク/コストに見合う価値なし |

### C-5. S-6 のまま運用継続した場合との差分

| 観点 | S-6 継続 | S-7 実施 |
|------|---------|---------|
| 自動リトライ | 動作中 | **変化なし** |
| ログ管理 | 手動削除 | 自動ローテーション |
| 異常検知 | 手動監視 | アラート通知（実装した場合） |
| 処理速度 | 逐次実行 | 並列化可能（実装した場合） |

**結論**: S-6 継続で致命的な問題は発生しない

### C-6. 人間の判断・運用で代替できる点

| 項目 | 人間の判断・運用での代替 |
|------|------------------------|
| 自動リトライ | **代替不要**（既存） |
| ログローテーション | 月1回の手動削除運用で代替可能 |
| 監視アラート | logs/phase_summary.json の定期確認で代替可能 |
| マルチプロセス | ジョブ分割で手動並列化可能 |

### C-7. 自動化しない方が良い理由

| 項目 | 自動化しない方が良い理由 |
|------|------------------------|
| ログローテーション | 重要ログの誤削除リスク（保持期間の判断は人間が行うべき場合あり） |
| 監視アラート | 誤報・過剰通知で通知疲れのリスク |
| マルチプロセス | 障害時の原因特定が困難になる |

### C-8. 経営・意思決定への影響

| 観点 | 影響 |
|------|------|
| コスト | S-7 追加機能のメンテナンスコスト増 |
| リスク | 機能追加による障害リスク増 |
| スピード | S-6 安定運用を優先すべき時期 |
| 判断 | **経営判断として「待ち」が合理的** |

### C-9. 今すぐ必要か／半年後でよいか

| 項目 | 判断 | 理由 |
|------|------|------|
| 自動リトライ | **不要**（既存） | 既に動作中 |
| ログローテーション | 半年後でよい | 当面はディスク容量に余裕あり |
| 監視アラート | 半年後でよい | 外部ツールで代替中 |
| マルチプロセス | 不要 | 処理量が増加した時点で再検討 |

### C-10. 「やらない」という選択肢の合理性

**「やらない」は合理的である**

理由：
1. **自動リトライは既に実装済み** - S-7 の主要目的の一つが既存機能で達成されている
2. **S-6 stable は本日完成したばかり** - 安定運用の実績がない状態で拡張は時期尚早
3. **業務上の緊急性がない** - 現行機能で日常運用は可能
4. **追加リスクを避けられる** - 機能追加による障害リスクを回避
5. **リソースの有効活用** - 拡張開発よりも S-6 の運用実績蓄積が優先

---

## D. 代替案・縮小案（31–40）

### D-1. S-7 を実装しない代替案

| 代替案 | 説明 |
|--------|------|
| S-6 継続運用 | 現行機能で運用を継続、問題発生時に対応 |
| 外部ツール併用 | ログ管理・監視を外部ツールで代替 |
| 運用ルール整備 | 手動運用のドキュメント整備で対応 |

### D-2. S-6 内の運用改善で済む案

| 改善案 | 内容 |
|--------|------|
| runbook 拡充 | ログ手動削除手順を追記 |
| 監視チェックリスト | 日次確認項目をドキュメント化 |
| 障害対応フロー | トラブルシューティング手順の詳細化 |

### D-3. 手動対応＋ルール整備で代替できる点

| 項目 | 手動対応ルール |
|------|---------------|
| ログローテーション | 「毎月1日に30日以上前のログを削除」をルール化 |
| 監視アラート | 「毎朝 phase_summary.json を確認」をルール化 |
| 異常時対応 | 「error ログ発見時は Slack で報告」をルール化 |

### D-4. 部分的 PoC に縮小する案

| PoC 案 | 内容 | 期間 |
|--------|------|------|
| ログローテーション PoC | rotate_logs.ps1 を作成し、test 環境でのみ実行 | 1日 |
| 監視アラート PoC | Slack 通知スクリプトを作成し、手動実行で確認 | 1日 |

### D-5. フラグ付き・限定利用で試す案

| 案 | 設定 |
|-----|------|
| ログローテーション | config に `log_rotation.enabled: false` 追加、手動で有効化 |
| 監視アラート | config に `alert.enabled: false` 追加、本番では無効のまま |

### D-6. 外部ツールで代替する可能性

| 項目 | 外部ツール |
|------|-----------|
| ログローテーション | Windows タスクスケジューラ + バッチファイル |
| 監視アラート | Datadog / CloudWatch / 自前監視スクリプト |
| ログ分析 | ELK Stack / Splunk |

### D-7. スコープを半分にした場合の成立性

**S-7 最小スコープ案**:
- ログローテーションスクリプトの追加のみ
- orchestrator_v0_3.py への変更なし
- config_v0_3.json への変更なし

**成立性**: 高（外部スクリプト追加のみなら S-6 stable を壊さない）

### D-8. フェーズ分割をさらに細かくする案

| フェーズ | 内容 | リスク |
|---------|------|--------|
| S-7a | ログローテーションスクリプト追加 | 低 |
| S-7b | config にローテーション設定追加（optional） | 低 |
| S-7c | 監視アラート PoC | 低 |
| S-7d | 監視アラート本実装（必要と判断された場合のみ） | 中 |

### D-9. 完全に見送る場合の判断理由

**見送り理由**:
1. S-6 stable の安定運用期間が不足（30日未満）
2. 自動リトライは既存機能で動作中（S-7 の主要目的達成済み）
3. ログローテーション・監視アラートは外部ツール/手動運用で代替可能
4. マルチプロセス等の大規模変更は費用対効果が低い
5. リスクを冒す合理的理由がない

### D-10. 将来再検討する条件

| トリガー | 再検討内容 |
|---------|-----------|
| S-6 stable 30日安定運用達成 | S-7 全項目の再評価 |
| ディスク容量警告発生 | ログローテーション実装の再検討 |
| 異常検知の遅延で業務影響発生 | 監視アラート実装の再検討 |
| 処理量増加で待ち時間が業務影響 | マルチプロセス実装の再検討 |
| 新規業務要件発生 | 要件に応じた機能追加の検討 |

---

## E. 結論の精緻化（41–50）

### E-1. S-7 を「やる／やらない／保留」のいずれかに再分類

**結論: やらない（S-7 は不要）**

### E-2. 再分類の理由

1. **自動リトライは既存機能で実装済み**
   - orchestrator_v0_3.py:201-258 に api_retry 付きリトライ実装あり
   - orchestrator_v0_3.py:261-294 に json_retry 付きリトライ実装あり
   - S-7 の主要目的の一つが S-6 で既に達成されている

2. **残りの Should 項目は外部ツール/手動運用で代替可能**
   - ログローテーション: タスクスケジューラ + バッチで対応可能
   - 監視アラート: 外部監視ツールで対応可能

3. **S-6 stable の安定運用期間が不足**
   - 本日完成したばかりで実績がない
   - 30日の安定運用を確認してから判断すべき

4. **リスクを冒す合理的理由がない**
   - 現行機能で業務は遂行可能
   - 追加機能による障害リスクを避けるべき

### E-3. 「やる」場合の最短開始条件

S-7 を開始する場合の最短条件（参考）:

1. S-6 stable が 30 日以上安定運用されていること
2. 運用上の明確な課題が文書化されていること
3. 対応する具体的な業務要件が存在すること
4. 実装・テストに必要なリソースが確保されていること

### E-4. 「やる」場合の最小成功条件

S-7 を実施する場合の最小成功条件（参考）:

1. 既存 S-6 stable の動作に影響を与えないこと
2. 全テスト（test モード）が通過すること
3. ロールバック手順が文書化されていること
4. runbook.md が更新されていること

### E-5. 「保留」場合の再検討トリガー

※ 結論は「やらない」だが、状況変化時の再検討トリガー：

| トリガー | アクション |
|---------|-----------|
| ディスク容量 80% 到達 | ログローテーション検討 |
| API エラーが週 5 回以上発生 | リトライ設定の見直し（現行設定の調整） |
| 異常検知遅延による業務影響 | 監視アラート検討 |
| 処理待ち時間が 1 時間超 | マルチプロセス検討 |
| 新規業務要件発生 | 要件に応じて個別検討 |

### E-6. 「やらない」場合の正式理由

**S-7 実施を見送る正式理由**:

```
S-7（拡張フェーズ）は以下の理由により実施しない：

1. 主要目的達成済み: 自動リトライ機能は S-6 で既に実装されている
2. 代替手段存在: 残りの機能は外部ツール/手動運用で代替可能
3. 安定性優先: S-6 stable の安定運用実績を蓄積すべき時期である
4. リスク回避: 機能追加による障害リスクを避けるべきである
5. 費用対効果: 実装コストに見合う価値が現時点では存在しない

以上により、S-7 は「不要」と判断し、S-6 stable の運用を継続する。
```

### E-7. 結論の要約

| 項目 | 結論 |
|------|------|
| S-7 全体 | **やらない**（不要） |
| 自動リトライ | **実装済み**（S-6 で動作中） |
| ログローテーション | 外部ツール/手動運用で代替 |
| 監視アラート | 外部ツールで代替 |
| マルチプロセス | 見送り（リスク/コストに見合わない） |
| その他（GUI等） | スコープ外（検討不要） |

---

## 最終結論

### S-7 検討の総括

**結論: S-7 は「やらない」（不要）**

理由の要約:
1. **自動リトライは既に S-6 で実装済み** - 追加実装は不要
2. **残りの機能は代替手段で対応可能** - 外部ツール/手動運用で十分
3. **S-6 stable の安定運用を優先** - 機能追加より安定性確保が重要
4. **リスクを冒す合理的理由がない** - 現行機能で業務は遂行可能

### 推奨アクション

1. **S-6 stable の運用を継続**
2. **30 日間の安定運用実績を蓄積**
3. **運用上の課題が発生した場合に個別対応**
4. **本ドキュメントを正史に記録し、将来の参考資料とする**

### 正史コンテキストとの整合

- S-7 は「検討完了・不要」として記録
- S-6 stable は継続運用
- 将来の再検討はトリガー条件発生時に実施

---

## 検討B 完了確認

- [x] A. 技術的実現性チェック（1–10）完了
- [x] B. 運用・安全面の検証（11–20）完了
- [x] C. ビジネス・価値面の再評価（21–30）完了
- [x] D. 代替案・縮小案（31–40）完了
- [x] E. 結論の精緻化（41–50）完了

**S-7 検討B 完了: 2025-12-14**

---

# 再発防止・整理

## なぜ S-7 を検討するに至ったか

1. **S-6 governance の「既知の未対応事項」** - S-6 stable 完成時に将来の拡張候補を列挙した
2. **自然な開発サイクル** - S-5 → S-6 完成後、次のフェーズを検討するのは自然な流れ
3. **機能追加の誘惑** - 「あると便利」な機能のリストが存在していた

## 同様の検討が再発しないための判断基準

### S-7 再検討を禁止する期間

**2025-06-14 まで S-7 の再検討を禁止する。**

### 再検討時に必ず読むべき文書

1. **docs/s7_proposal.md**（本ドキュメント）- 検討経緯と結論
2. **docs/s6_governance.md** - ガバナンス・判断基準
3. **docs/s6_stable.md** - S-6 運用ルール

### 安易な拡張要求を却下する文言

```
S-7（拡張フェーズ）は 2025-12-14 に「不要」と確定しています。

再検討は以下の条件を満たす場合のみ許可されます：
1. 2025-06-14 以降であること
2. 明文化されたトリガー条件（ディスク容量80%、APIエラー週5回以上等）が発生したこと
3. 具体的な業務要件が文書化されていること

上記を満たさない拡張要求は却下されます。
docs/s7_proposal.md を参照してください。
```

## S-6 を守るための原則（再掲）

1. **安定性最優先** - 機能追加より安定運用
2. **変更最小化** - 必要最小限の変更のみ
3. **ドキュメント優先** - 実装変更よりドキュメント整備
4. **リスク回避** - 「やらない」判断を尊重

## 技術的好奇心と運用安定の線引き

| 動機 | 判断 |
|------|------|
| 「あると便利」 | **却下** - 業務上の緊急性がない |
| 「技術的に興味がある」 | **却下** - 安定運用が優先 |
| 「将来使うかもしれない」 | **却下** - 必要になったら検討 |
| 「業務で困っている」 | **検討可** - トリガー条件を満たすか確認 |
| 「業務に支障が出ている」 | **検討可** - 具体的な影響を文書化 |

## 「やらない判断」を正とする文化

**「やらない」という判断は、怠慢ではなく合理的な選択である。**

理由：
1. 機能追加にはリスクが伴う
2. 安定した現行機能は価値がある
3. 運用コストの増加を防げる
4. 将来の選択肢を保持できる

## 判断を尊重するルール

1. **本ドキュメントの結論を覆すには、明文化されたトリガー条件が必要**
2. **感情的・直感的な拡張要求は却下される**
3. **判断の記録は正史として残し、将来の参考とする**
4. **「やらない」判断も「やる」判断と同等の価値を持つ**

---

# S-7 結論確定 完了

## 完了チェックリスト

- [x] S-7 の結論が正史として固定されている
- [x] 「やらない」選択も明確に残っている
- [x] 実装変更なし
- [x] 将来の再検討条件が明文化されている

**S-7 結論確定: 2025-12-14**
