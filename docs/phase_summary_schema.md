# phase_summary.json Schema

## Overview

phase_summary.json is generated by the orchestrator at the end of each phase and summarizes execution results.

## Location

`logs/phase_summary.json`

## Schema

```json
{
  "generated_at": "2025-12-13T23:47:17.404197",
  "current_phase": "S-5",
  "previous_phase": "S-4",
  "is_experimental": true,
  "experimental": true,
  "job_loop_enabled": true,
  "job_loop": {
    "enabled": true,
    "max_jobs": 3,
    "job_name": "sample",
    "current_job_index": 4,
    "completed": true
  },
  "job_payload_present": true,
  "job_result_written": true,
  "job_result_path": "C:\\Users\\takag\\00_dev\\tos\\workspace\\artifacts\\job_result.json",
  "job_result_path_posix": "C:/Users/takag/00_dev/tos/workspace/artifacts/job_result.json",
  "total_steps": 3,
  "success_count": 2,
  "fail_count": 0,
  "denied_count": 0,
  "fatal_error_count": 0,
  "stopped_count": 0,
  "skipped_count": 0,
  "final_done": true,
  "final_phase_result": {
    "next_phase_name": "S-5",
    "next_phase_done_condition": "...",
    "next_instruction_id": "...",
    "next_instruction_summary": "...",
    "next_instruction_inputs": [],
    "next_instruction_expected_outputs": []
  },
  "execution_summary": {},
  "stop_on_deny": true,
  "end_reason": "job_loop_complete: max_jobs(3)...",
  "denied_steps": [],
  "fatal_error_steps": [],
  "stopped_steps": [],
  "skipped_steps": [],
  "steps": [
    {
      "step_num": 1,
      "phase": "job_loop_complete",
      "done": true,
      "done_reason": "...",
      "timestamp": "2025-12-13T23:47:17.403197",
      "error": null,
      "message": "job_loop...",
      "stopped": false
    }
  ]
}
```

## Field Descriptions

### Core Fields

| Field | Type | Description |
|-------|------|-------------|
| generated_at | string | ISO timestamp of generation |
| current_phase | string | Current phase name (S-4, S-5, done, deny, fatal_error, job_loop_complete) |
| previous_phase | string | Previous phase name |
| is_experimental | boolean | True if experimental mode |
| experimental | boolean | True if experimental mode (redundant) |

### Job Loop Fields

| Field | Type | Description |
|-------|------|-------------|
| job_loop_enabled | boolean | True if job_loop is enabled |
| job_loop | object | Job loop configuration and state |
| job_loop.enabled | boolean | Job loop enabled flag |
| job_loop.max_jobs | number | Maximum number of jobs |
| job_loop.job_name | string | Job name |
| job_loop.current_job_index | number | Current job index (1-based) |
| job_loop.completed | boolean | True if job_loop is completed |

### Job Payload/Result Fields

| Field | Type | Description |
|-------|------|-------------|
| job_payload_present | boolean | True if job_input.json exists |
| job_result_written | boolean | True if job_result.json was written |
| job_result_path | string | Path to job_result.json (Windows format) |
| job_result_path_posix | string | Path to job_result.json (POSIX format) |

### Execution Statistics

| Field | Type | Description |
|-------|------|-------------|
| total_steps | number | Total number of steps executed |
| success_count | number | Number of successful steps |
| fail_count | number | Number of failed steps |
| denied_count | number | Number of denied steps |
| fatal_error_count | number | Number of fatal error steps |
| stopped_count | number | Number of stopped steps |
| skipped_count | number | Number of skipped steps |

### Control Fields

| Field | Type | Description |
|-------|------|-------------|
| final_done | boolean | True if final done condition is met |
| stop_on_deny | boolean | Current stop_on_deny setting |
| end_reason | string | Reason for execution termination |
| execution_summary | object | Additional execution summary (always present, may be empty) |

### Step Lists

| Field | Type | Description |
|-------|------|-------------|
| denied_steps | array | List of denied step numbers |
| fatal_error_steps | array | List of fatal error step numbers |
| stopped_steps | array | List of stopped step numbers |
| skipped_steps | array | List of skipped step numbers |
| steps | array | Array of step summary objects |

### Step Object

| Field | Type | Description |
|-------|------|-------------|
| step_num | number | Step number |
| phase | string | Phase at step completion |
| done | boolean | Step done status |
| done_reason | string | Reason for done status |
| timestamp | string | ISO timestamp |
| error | string/null | Error message if any |
| message | string | Step message |
| stopped | boolean | True if step was stopped |

## Related Files

- `logs/steps/step_XXX.json` - Individual step logs
- `workspace/artifacts/phase_state.json` - Current phase state
- `workspace/artifacts/job_input.json` - Job input payload
- `workspace/artifacts/job_result.json` - Job result output
